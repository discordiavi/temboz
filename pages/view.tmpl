## -*- html -*-
#from singleton import db
#import time
#import param
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><title>Temboz - unread items</title>
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<script>
hidden = Array();
function webop(op, uid) {
  var i = new Image();
  i.src = '/feedback/' + op + '/' + Math.random().toString().substring(8) + '/' + uid + '.gif';
}
function hide(id) {
  elt = document.getElementById('art' + id);
  if(elt.style.backgroundColor == "yellow") {
    elt.style.backgroundColor = "";
    webop('basic', id);
  } else {
    hidden[hidden.length] = elt;
    elt.style.display = "none";
    webop('demote', id);
  }
}
function highlight(id) {
  elt = document.getElementById('art' + id);
  elt.style.backgroundColor = "yellow";
  webop('promote', id);
}
function unhide_all() {
  for(i=0; i<hidden.length; i++) {
    elt = hidden[i];
    elt.style.display = "block";
    webop('basic', elt.id.substring(3));
  }
  hidden = Array();
}
function unhide_last() {
  if(hidden.length > 0) {
    elt = hidden[hidden.length - 1];
    elt.style.display = "block";
    webop('basic', elt.id.substring(3));
    hidden.length = hidden.length - 1
  }
}
function toggle(item)
{
	document.items[item].checked = !document.items[item].checked;
}
</script>
<link rel="stylesheet" type="text/css" href="/temboz.css">
<style type="text/css">
</style>
</head>
<body>

#set c = db.cursor()
#silent c.execute("""update fm_items set item_viewed=julianday('now') where item_uid in (select item_uid from fm_items where item_rating = 0
order by item_created DESC, item_uid DESC
limit %d)""" % param.overload_threshold)
#silent c.execute("""select count(*) from fm_items where item_rating=0""")
#set $num_items = int(c.fetchone()[0])
#set $cutoff = ($num_items + 1) / 2 + 1
#set $count = 0
<p class="menu">$num_items new items
#if $num_items > $param.overload_threshold:
($param.overload_threshold shown)
#set cutoff = (param.overload_threshold + 1) / 2 + 1
#end if
&nbsp;&nbsp;<a href="javascript:unhide_all();">Unhide all</a>&nbsp;&nbsp;<a href="javascript:unhide_last();">Unhide last</a>&nbsp;&nbsp;<a href="/feeds/">All feeds</a>&nbsp;&nbsp;<a href="/add/">Add feed</a></p>
#silent c.execute("""select item_uid, item_creator, item_title, item_link,
item_content, datetime(item_loaded), date(item_created),
feed_title, feed_html, feed_xml, julianday('now') - julianday(item_created)
from fm_items, fm_feeds where item_feed_uid=feed_uid
and item_rating = 0 order by item_created DESC, item_uid DESC
limit %d""" % param.overload_threshold)
<div class="col1">
#for uid, creator, title, link, content, loaded, created, feed_title, feed_html, feed_xml, delta_created in c:
#set $count += 1
#if $count == $cutoff:
</div><div class="col2">
#end if
#set delta_created = float(delta_created)
#if delta_created < 1.0/24:
#set since = str(int(delta_created * 24.0 * 60.0)) + ' minutes ago'
#elif delta_created < 1.0:
#set since = str(int(delta_created * 24.0)) + ' hours ago'
#elif delta_created < 3.0:
#set since = str(int(delta_created)) + ' days ago'
#else
#set since = created
#end if
<div class="article" id="art$uid"><div class="headline"><img width="32" height="32" alt="up" src="/up.gif" class="up" onclick="highlight('$uid')" /><img width="32" height="32" alt="down" src="/down.gif" class="down" onclick="hide('$uid')" /><a href="/redirect/$uid" class="headline" target="_blank" onclick="highlight('$uid');">$title</a><br><a href="$feed_html" title="" class="source">$feed_title</a> - $since<br><!-- by $creator, cached at $loaded --></div><div class="content">$content</div></div>
#end for
</div>
#silent db.commit()
#silent c.close()

<div style="clear: both;" />
</body></html>
